{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>bld | 서울시립대 음식점</title>
  <link rel="stylesheet" type="text/css" href="{% static 'base_app/css/base.css' %}">
  <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'base_app/css/swiper.min.css' %}">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
</head>
<body>

<!-- Swiper -->
<div class="swiper-container">
  <div class="swiper-wrapper">
    <div class="swiper-slide menu">
      <div class="content_head">
        <div class="head_left">
          <div class="main_menu"><img src="{% static 'base_app/images/menu.png' %}" height="25"></div>
        </div>
        <div class="head_right">
          <div class="all_comments" id="head_right4">
            <a href="{% url "base_app:all_comments" %}">
              <img src="{% static 'base_app/images/comments.png' %}" height="25">
            </a>
          </div>
          <div class="map" id="head_right3">
            <img src="{% static 'base_app/images/map.png' %}" height="25">
          </div>
          <div class="filter" id="head_right2">
            <img src="{% static 'base_app/images/filter.png' %}" height="22">
          </div>
          <div class="search" id="head_right1">
            <img src="{% static 'base_app/images/searching.png' %}" height="23">
          </div>
        </div>
        <div style="display: none" class="search_input">
          <form method="get" action="" id="search_submit">
            <input class="search_text" type="text" name="search" placeholder="검색어를 입력해주세요." required>
          </form>
        </div>
      </div>
      <div style="display: none" class="black_block"></div>
      <div style="display: none" class="main_menu_bar">
        <div class="logo"><img src="{% static 'base_app/images/logo.png' %}" width="100"></div>
        <div class="notice">
          <div>ver 1.0</div>
          <div>공지</div>
        </div>
        <div class="log">
          <div>로그인</div>
          <div>회원가입</div>
        </div>
      </div>
      <div style="display: none" class="white_block"></div>

      <!--mid-->
      <div class="content_mid">
        {% block content %}
        <div class="main_page">
            <!--filter-->
{#          <div class="category_list">#}
{#            <span>#}
{#              <select class="select_bar" id="select_filter">#}
{#                <option selected value="0">등록순</option>#}
{#                <option value="1">평점순</option>#}
{#                <option value="2">인기순</option>#}
{#              </select>#}
{#            </span>#}
{#            <span>#}
{#              <select class="select_bar" id="select_category">#}
{#                <option selected>카테고리</option>#}
{#                <option value="전체">전체</option>#}
{#                {% for category in categorys %}#}
{#                  <option value="{{ category }}">{{ category }}</option>#}
{#                {% endfor %}#}
{#              </select>#}
{#            </span>#}
{#          </div>#}
            <!--restaurants-->
          <div class="content_list restaurants">
            {% for restaurant in sort_grade %}
              <div class="restaurant_set {{ restaurant.category }}">
                <div style="height: 60px; width: 60px; background-color: #9dc9ec" class="restaurant_image"></div>
                <div class="restaurant_content">
                  <div class="restaurant_content_left">
                    <div class="restaurant_name">{{ restaurant }}</div>
                    <div class="restaurant_info">010-0000-0000<br>0요일 오후 0시 ~ 오후 0시</div>
                    <div class="restaurant_star">
                      <b>{{ restaurant.average_star }}</b><span class="comment_count"> {{ restaurant.comment_count }}</span>
                      <span>맛 {{ restaurant.taste_star }}  가격 {{ restaurant.price_star }}  청결 {{ restaurant.clean_star }}</span>
                    </div>
                  </div>
                  <div class="restaurant_content_right">
                    <div><span>혼밥 </span><span>{% if restaurant.is_eating_lonely_possible %}{{ restaurant.is_eating_lonely_possible }}{% else %}-{% endif %}</span></div>
                    <div><span>포장 </span><span>{% if restaurant.is_package_possible %}{{ restaurant.is_package_possible }}{% else %}-{% endif %}</span></div>
                    <div><span>배달 </span><span>{% if restaurant.is_delivery_possible %}{{ restaurant.is_delivery_possible }}{% else %}-{% endif %}</span></div>
                  </div>
                </div>
                <a href="{% url "base_app:restaurant" pk=restaurant.pk %}"><div class="comments">후<br>기<br>보<br>기</div></a>
              </div>
            {% endfor %}
          </div>
        </div>

          <!--plus-->
        <div class="black_background plus_hide"></div>
        <div style="display: none"  class="plus page2" id="plus"><img src="{% static 'base_app/images/plus.png' %}" width="50"></div>
        <div class="plus plus1 plus_hide">
          <a href="{% url "base_app:all_comments" %}"><img src="{% static 'base_app/images/comment.png' %}" width="50"></a>
        </div>
        <div class="plus plus1 message1 plus_hide">전체 후기</div>
        <div class="plus plus2 plus_hide">
          <img src="{% static 'base_app/images/recommend.png' %}" width="50">
        </div>
        <div class="plus plus2 message2 plus_hide">오늘 뭐먹?(예정)</div>
        <div class="plus plus3 plus_hide">
          <img src="{% static 'base_app/images/filter.png' %}" width="50">
        </div>
        <div class="plus plus3 message3 plus_hide">필터(예정)</div>
        {% endblock %}
      </div>


    </div>
    <div class="swiper-slide content">

      <div class="map">
        <!--map-->
        <div id="map"></div>
      </div>
      <div class="menu-button cross">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </div>
    </div>
  </div>
</div>

  <!--jquery-->
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

  <!-- Swiper JS -->
{#<script src='../../static/base_app/js/swiper.min.js'></script>#}
<script src="{% static 'base_app/js/swiper.min.js' %}"></script>

<!-- Initialize Swiper -->
<script>
  var menuButton = document.querySelector('.menu-button');
  var map = document.querySelector('.map');
  var swiper = new Swiper('.swiper-container', {
    slidesPerView: 'auto',
    initialSlide: 0,
    resistanceRatio: 0,
    slideToClickedSlide: false,
    allowTouchMove: false,
    on: {
      init: function () {
        var slider = this;
        menuButton.addEventListener('click', function () {
          if (slider.activeIndex === 0) {
            slider.slideNext();
          } else {
            slider.slidePrev();
          }
        }, true);

        map.addEventListener('click', function () {
          if (slider.activeIndex === 0) {
            slider.slideNext();
          } else {
            slider.slidePrev();
          }
        }, true);
      },
      slideChange: function () {
        var slider = this;
        if (slider.activeIndex === 0) {
          menuButton.classList.add('cross');
        } else {
          menuButton.classList.remove('cross');
        }
      },
    },
  });
</script>

{% block mapMarker %}
  <!--map setting -->
  <script>
    var markers = [];
    var markerCluster= null;
    // TODO: category 해당 restaurant 추출
    var selected_category = '';
    $(".category_set").on('click', function () {
        var selected_category = this.classList[1]
    });
    function initMap() {
// map options
            var options = {
                center: {lat: 37.583929, lng: 127.059024},
                zoom: 15,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: false,
                maxZoom: 21,
            };

            // new map
            var map = new
            google.maps.Map(document.getElementById('map'), options);
            {% for restaurant in restaurants %}
                var marker = new google.maps.Marker({
                    position: {{ restaurant.locate }},
                    map: map,
                });

                // 클릭 시 restaurant 소개 & 센터 오게
                var restaurant_introduction =
                    '<div style="width: 250px; border-bottom: none; margin-bottom: 8px; margin-top: 16px; margin-right: 10px;" class="restaurant_set">\n' +
                    ' <div style="height: 60px; width: 60px; background-color: #9dc9ec" class="restaurant_image"></div>\n' +
                    ' <div class="restaurant_content">\n' +
                    '   <div class="restaurant_content_left">\n' +
                    '     <div class="restaurant_name"><b>{{ restaurant }}</b></div>\n' +
                    '     <div class="restaurant_info">010-0000-0000<br>0요일 오후 0시 ~ 오후 0시</div>\n' +
                    '     <div class="restaurant_star">\n' +
                    '       <b>{{ restaurant.average_star }}</b><span class="comment_count"> {{ restaurant.comment_count }}</span>\n' +
                    '       <span>맛 {{ restaurant.taste_star }}  가격 {{ restaurant.price_star }}  청결 {{ restaurant.clean_star }}</span>\n' +
                    '     </div>\n' +
                    '   </div>\n' +
                    '   <div class="restaurant_content_right">\n' +
                    '     <div><span>혼밥 </span><span>{% if restaurant.is_eating_lonely_possible %}{{ restaurant.is_eating_lonely_possible }}{% else %}-{% endif %}</span></div>\n' +
                    '     <div><span>포장 </span><span>{% if restaurant.is_package_possible %}{{ restaurant.is_package_possible }}{% else %}-{% endif %}</span></div>\n' +
                    '     <div><span>배달 </span><span>{% if restaurant.is_delivery_possible %}{{ restaurant.is_delivery_possible }}{% else %}-{% endif %}</span></div>\n' +
                    '   </div>\n' +
                    ' </div>\n' +
                    ' <a href="{% url "base_app:restaurant" pk=restaurant.pk %}"><div class="comments">후<br>기<br>보<br>기</div></a>\n' +
                    '</div>\n';

                marker['infowindow'] = new google.maps.InfoWindow({
                    content: restaurant_introduction,
                });

                marker.addListener('click', function() {
                    map.setZoom(21);
                    map.panTo(this.getPosition());
                    this['infowindow'].open(map, this);
                });
                markers.push(marker);
            {% endfor %}

            var markerCluster = new MarkerClusterer(map, markers,
                {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
    }

  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbX8bL78zKMX1D7viqLsXJikPwaLB8omQ&callback=initMap"
  async defer></script>
  <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
  </script>
{% endblock %}



<script>
  // select bar 클릭 시 배열 변화
  var select_filter = $('#select_filter');
  var select_category = $('#select_category');

  // 필터로 순서 변경
  select_filter.change(function () {
      if (this.value == 0) {
          $('.sort_register').show();
          $('.sort_grade').hide();
          $('.sort_comments').hide();
      } else if (this.value == 1) {
          $('.sort_register').hide();
          $('.sort_grade').show();
          $('.sort_comments').hide();
      } else {
          $('.sort_register').hide();
          $('.sort_grade').hide();
          $('.sort_comments').show();
      }
  });
  // 카테고리 선택
  select_category.change(function () {
      for (i=0; i<restaurant_set.length; i++) {
          if (this.value.split(' ')[0] === $('.restaurant_set')[i].classList[1]) {
              restaurant_set[i].style.display = "flex"
          } else {
              restaurant_set[i].style.display = "none"
          }
      }
      if (this.value === "전체") {
          restaurant_set.css('display', 'flex')
      }
  });

  // plus 버튼 클릭 시
$('#plus').on('click', function () {
    if ($('.plus_hide').css('display') === 'none') {
        $('#plus').css('-webkit-transform', 'rotate(45deg)');
        $('#plus').css('-webkit-transition', '-webkit-transform 1s');
        $('.plus').children('img').css('box-shadow', 'none');
        $('.plus_hide').fadeIn(800);
        $('.search_input').hide()
    } else {
        plusDefault()
    }
});

$('.black_background').on('click', function () {
  plusDefault()
});

function plusDefault () {
    $('#plus').css('-webkit-transform', 'rotate(0deg)');
    $('#plus').css('-webkit-transition', '-webkit-transform 1s');
    $('.plus_hide').fadeOut(0);
    $('#plus').children('img').css('box-shadow', '#999 0 3px 6px');
    $('#search').removeClass('search_bar_up').addClass('plus4');
    $('.search_input').hide();
    setTimeout(function(){
      $('.search_input').hide()
    }, 1000);
    setTimeout(function(){
      $('.search_input').hide()
    }, 1500);
}

  // 메뉴 클릭시
var menu = $('.main_menu');
var menuBar = $('.main_menu_bar');
var blackBlock = $('.black_block');

menu.on('click', function () {
    menuBar.show();
    blackBlock.show();
});
blackBlock.on('click', function () {
    menuBar.hide();
    blackBlock.hide();
});

  // search 버튼 클릭 시
var search = $('.search');
var searchBox = $('.search_input');
var searchText = $('.search_text');
var whiteBlock = $('.white_block');

search.on('click', function () {
    searchBox.fadeIn(500);
    whiteBlock.fadeIn(500);
    search.on('click', function () {
        if (searchText.val()) {
            $("#search_submit").submit();
        }
    });
});
whiteBlock.on('click', function () {
    searchBox.fadeOut(500);
    whiteBlock.fadeOut(500);
    searchText.val('')
});

  // scroll 시 plus 버튼 일시적으로 없애기
$('.comment_list').on('touchmove', hideScroll);
$('.restaurants').on('touchmove', hideScroll);
$('.comment_list').on('scroll', hideScroll);
$('.restaurants').on('scroll', hideScroll);

function hideScroll() {
    $('#plus').hide().fadeIn(1500)
}

</script>

</body>
</html>